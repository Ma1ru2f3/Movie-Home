<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Moviebox</title>
<style>
body { font-family: Arial; margin: 0; padding: 0; background: #f2f2f2; }
.navbar { display: flex; background: #222; color: #fff; padding: 10px; }
.navbar div { margin-right: 20px; cursor: pointer; }
.container { padding: 20px; }
.video-item { margin-bottom: 20px; }
.progress { width: 100%; background: #ddd; }
.progress-bar { width: 0%; height: 20px; background: green; }
</style>
</head>
<body>

<div class="navbar">
  <div id="home">Home</div>
  <div id="search">Search</div>
  <div id="fvrt">Favorite</div>
  <div id="profile">Profile</div>
</div>

<div class="container" id="content">
  <h2>Home</h2>
  <div id="video-list"></div>
</div>

<script>
const content = document.getElementById("content");

document.getElementById("home").onclick = loadHome;

document.getElementById("profile").onclick = () => {
  const html = `
    <h2>Admin Login</h2>
    <input type="text" id="user" placeholder="Username"/><br/>
    <input type="password" id="pass" placeholder="Password"/><br/>
    <button id="login">Login</button>
    <div id="admin-area"></div>
  `;
  content.innerHTML = html;
  document.getElementById("login").onclick = adminLogin;
};

function loadHome() {
  fetch("/videos").then(res => res.json()).then(videos => {
    let html = "<h2>Home</h2>";
    videos.forEach(v => {
      html += `<div class="video-item">
        <h4>${v.title}</h4>
        <video width="400" controls>
          <source src="${v.url}" type="video/mp4">
        </video>
      </div>`;
    });
    content.innerHTML = html;
  });
}

function adminLogin() {
  const user = document.getElementById("user").value;
  const pass = document.getElementById("pass").value;
  const adminArea = document.getElementById("admin-area");
  adminArea.innerHTML = `
    <h3>Upload Video</h3>
    <input type="text" id="title" placeholder="Title"/><br/>
    <input type="file" id="video"/><br/>
    <button id="upload">Upload</button>
    <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
    <div id="message"></div>
  `;
  document.getElementById("upload").onclick = () => uploadVideo(user, pass);
}

function uploadVideo(user, pass) {
  const file = document.getElementById("video").files[0];
  const title = document.getElementById("title").value;
  if(!file) return alert("Select file");
  const formData = new FormData();
  formData.append("video", file);
  formData.append("title", title);
  formData.append("user", user);
  formData.append("pass", pass);
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/upload", true);
  xhr.upload.onprogress = e => {
    const percent = Math.round((e.loaded / e.total) * 100);
    document.getElementById("progress-bar").style.width = percent + "%";
  };
  xhr.onload = () => {
    if(xhr.status === 200){
      document.getElementById("message").innerText = "Uploaded Successfully!";
      loadHome();
    } else {
      document.getElementById("message").innerText = "Upload Failed";
    }
  };
  xhr.send(formData);
}

// Initial load
loadHome();
</script>

</body>
</html>