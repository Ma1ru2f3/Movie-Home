<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moviebox</title>
<style>
  body{ font-family: Arial; padding:20px; background:#f4f4f4; }
  .nav{ margin-bottom:20px; }
  .nav button{ margin-right:10px; padding:10px; }
  #videoList video{ width:200px; margin:10px; display:block; }
  .progress-container{ width:100%; background:#ccc; height:10px; margin-top:5px; }
  .progress-bar{ height:10px; width:0; background:green; }
</style>
</head>
<body>

<div class="nav">
  <button onclick="showSection('home')">Home</button>
  <button onclick="showSection('search')">Search</button>
  <button onclick="showSection('fvrt')">Favorite</button>
  <button onclick="showSection('profile')">Profile</button>
</div>

<div id="home" class="section">
  <h2>Home</h2>
  <div id="videoList"></div>
</div>

<div id="search" class="section" style="display:none;">
  <h2>Search</h2>
  <input type="text" id="searchInput" placeholder="Search video..." onkeyup="searchVideos()">
  <div id="searchResults"></div>
</div>

<div id="fvrt" class="section" style="display:none;">
  <h2>Favorite</h2>
  <div id="favoriteList"></div>
</div>

<div id="profile" class="section" style="display:none;">
  <h2>Admin Profile</h2>
  <input type="text" id="adminUser" placeholder="Admin Username"><br>
  <input type="password" id="adminPass" placeholder="Admin Password"><br>
  <button onclick="adminLogin()">Login</button>

  <div id="adminPanel" style="display:none; margin-top:20px;">
    <h3>Upload Video</h3>
    <input type="file" id="videoFile"><br>
    <input type="text" id="videoTitle" placeholder="Video Title"><br>
    <button onclick="uploadVideo()">Upload</button>
    <div class="progress-container">
      <div id="uploadProgress" class="progress-bar"></div>
    </div>
    <div id="uploadStatus"></div>
  </div>
</div>

<script>
let videos = [];
let loggedIn = false;

// Show sections
function showSection(section){
  document.querySelectorAll('.section').forEach(s => s.style.display='none');
  document.getElementById(section).style.display='block';
}

// Admin login
function adminLogin(){
  const user = document.getElementById('adminUser').value;
  const pass = document.getElementById('adminPass').value;
  if(user==='admin' && pass==='1234'){ 
    loggedIn=true;
    document.getElementById('adminPanel').style.display='block';
    alert("Admin logged in");
  }else{
    alert("Invalid credentials");
  }
}

// Upload video with live progress
function uploadVideo(){
  if(!loggedIn){ alert("Admin not logged in"); return; }
  const file = document.getElementById('videoFile').files[0];
  const title = document.getElementById('videoTitle').value;
  if(!file || !title){ alert("Select file and enter title"); return; }

  const formData = new FormData();
  formData.append("video", file);
  formData.append("title", title);
  formData.append("user","admin");
  formData.append("pass","1234");

  const xhr = new XMLHttpRequest();
  xhr.open("POST","/upload",true);

  xhr.upload.addEventListener("progress", e => {
    if(e.lengthComputable){
      const percent = (e.loaded/e.total)*100;
      document.getElementById('uploadProgress').style.width = percent+"%";
      document.getElementById('uploadStatus').innerText = "Uploading: "+Math.round(percent)+"%";
    }
  });

  xhr.onload = function(){
    if(xhr.status===200){
      const res = JSON.parse(xhr.responseText);
      document.getElementById('uploadStatus').innerText = "Upload Successful!";
      document.getElementById('uploadProgress').style.width="100%";
      videos.unshift(res);
      renderVideos();
    } else {
      document.getElementById('uploadStatus').innerText = "Upload Failed!";
    }
  }

  xhr.send(formData);
}

// Render videos on home
function renderVideos(){
  const container = document.getElementById('videoList');
  container.innerHTML='';
  videos.forEach(v=>{
    const vid = document.createElement('video');
    vid.src=v.url;
    vid.controls=true;
    const title = document.createElement('p');
    title.innerText = v.title;
    container.appendChild(title);
    container.appendChild(vid);
  });
}

// Search videos
function searchVideos(){
  const query = document.getElementById('searchInput').value.toLowerCase();
  const container = document.getElementById('searchResults');
  container.innerHTML='';
  videos.filter(v=>v.title.toLowerCase().includes(query))
        .forEach(v=>{
          const vid = document.createElement('video');
          vid.src=v.url;
          vid.controls=true;
          const title = document.createElement('p');
          title.innerText=v.title;
          container.appendChild(title);
          container.appendChild(vid);
        });
}
</script>

</body>
</html>