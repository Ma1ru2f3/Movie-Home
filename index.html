<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie World</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
  body {font-family: Arial, sans-serif; margin:0; padding:0; background:#f2f2f2;}
  nav {display:flex; justify-content:space-around; padding:10px; background:#2196F3; color:white; font-weight:bold; font-size:18px;}
  nav div {cursor:pointer;}
  nav div:hover {text-decoration:underline;}
  #content {padding:20px;}
  #profileSection {margin-top:20px;}
  button {padding:5px 10px; margin-top:5px; border:none; border-radius:5px; cursor:pointer;}
  #logoutBtn {background:#e53935; color:white;}
  #googleSignInBtn {background:#4285F4; color:white;}
</style>
</head>
<body>

<nav>
  <div id="homeBtn">üè† Home</div>
  <div id="searchBtn">üîç Search</div>
  <div id="historyBtn">üìú History</div>
  <div id="favBtn">‚≠ê Favourite</div>
  <div id="profileBtn">üë§ Profile</div>
</nav>

<div id="content">
  <div id="homeSection">Home content...</div>
  <div id="searchSection" style="display:none;">Search content...</div>
  <div id="historySection" style="display:none;">History content...</div>
  <div id="favSection" style="display:none;">Favourite content...</div>
  <div id="profileSection" style="display:none;">
    <div id="userInfo"></div>
    <div id="adminPanel" style="display:none;">
      <h3>Admin Dashboard</h3>
      <input type="text" id="videoTitle" placeholder="Title">
      <input type="text" id="videoLink" placeholder="MP4/YouTube/Facebook link">
      <input type="text" id="videoCategory" placeholder="Category">
      <button onclick="uploadVideo()">Upload Video</button>
    </div>
    <button id="logoutBtn" style="display:none;">Logout</button>
    <button id="googleSignInBtn" style="display:none;" onclick="googleLogin()">Sign in with Google</button>
  </div>
</div>

<script>
const sections = {homeBtn:'homeSection', searchBtn:'searchSection', historyBtn:'historySection', favBtn:'favSection'};

// Navbar click
for(let btn in sections){
  document.getElementById(btn).onclick = () => {
    for(let s in sections) document.getElementById(sections[s]).style.display='none';
    document.getElementById(sections[btn]).style.display='block';
  }
}

// Google Sign-in
const client_id = "36874627982-u6mhk7hmn0do1btuk7rs1p8tbnddne14.apps.googleusercontent.com";

function handleCredentialResponse(response) {
  localStorage.setItem('userToken', response.credential);
  const user = parseJwt(response.credential);
  localStorage.setItem('userName', user.name);
  localStorage.setItem('userEmail', user.email);
  showUser(user);
}

function parseJwt(token){
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
  const jsonPayload = decodeURIComponent(atob(base64).split('').map(c =>
    '%' + ('00'+c.charCodeAt(0).toString(16)).slice(-2)
  ).join(''));
  return JSON.parse(jsonPayload);
}

google.accounts.id.initialize({
  client_id: client_id,
  callback: handleCredentialResponse
});

function googleLogin(){
  google.accounts.id.prompt();
}

function showUser(user){
  document.getElementById('profileSection').style.display='block';
  document.getElementById('userInfo').innerHTML = `<p>Name: ${user.name}</p><p>Email: ${user.email}</p>`;
  document.getElementById('logoutBtn').style.display='inline-block';
  document.getElementById('googleSignInBtn').style.display='none';

  if(user.email==='mymaruf94@gmail.com'){
    document.getElementById('adminPanel').style.display='block';
  } else {
    document.getElementById('adminPanel').style.display='none';
  }
}

// Logout
document.getElementById('logoutBtn').onclick = ()=>{
  localStorage.clear();
  location.reload();
};

// Profile button click
document.getElementById('profileBtn').onclick = ()=>{
  for(let s in sections) document.getElementById(sections[s]).style.display='none';
  document.getElementById('profileSection').style.display='block';
  const name = localStorage.getItem('userName');
  const email = localStorage.getItem('userEmail');
  if(name && email){
    showUser({name,email});
  } else {
    document.getElementById('userInfo').innerHTML='<p>Please login:</p>';
    document.getElementById('logoutBtn').style.display='none';
    document.getElementById('adminPanel').style.display='none';
    document.getElementById('googleSignInBtn').style.display='inline-block';
  }
}

// Auto login on refresh
window.onload = ()=>{
  const name = localStorage.getItem('userName');
  const email = localStorage.getItem('userEmail');
  if(name && email){
    showUser({name,email});
  }
}

// Video Upload (example)
async function uploadVideo(){
  const title=document.getElementById('videoTitle').value;
  const link=document.getElementById('videoLink').value;
  const category=document.getElementById('videoCategory').value;
  if(!title||!link||!category){alert('Fill all fields'); return;}
  const data={title,link,category};
  const url='https://sheetdb.io/api/v1/3p5l2ilgzemvr';
  try{
    await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({data})});
    alert('Upload Success ‚úÖ');
  }catch(e){alert('Upload Failed ‚ùå');console.error(e);}
}
</script>

</body>
</html>