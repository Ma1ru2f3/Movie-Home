<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MovieBox</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    nav button { margin: 5px; }
    .video-container { margin-top: 20px; }
    video { max-width: 300px; margin: 10px; }
    .progress-bar { width: 0; height: 20px; background: green; margin-top: 5px; }
  </style>
</head>
<body>
  <nav>
    <button id="homeBtn">Home</button>
    <button id="searchBtn">Search</button>
    <button id="fvrtBtn">Fvrt</button>
    <button id="profileBtn">Profile</button>
  </nav>

  <div id="adminSection" style="display:none;">
    <h3>Admin Panel</h3>
    <form id="uploadForm">
      <input type="text" name="title" placeholder="Video title" required>
      <input type="file" name="video" accept="video/*" required>
      <button type="submit">Upload</button>
    </form>
    <div class="progress-bar" id="progressBar"></div>
    <div id="uploadStatus"></div>
  </div>

  <div class="video-container" id="videoContainer"></div>

<script>
let adminLoggedIn = false;

document.getElementById("profileBtn").onclick = () => {
  if(!adminLoggedIn) {
    const user = prompt("Admin User:");
    const pass = prompt("Admin Pass:");
    fetch("/upload", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user, pass })
    }).then(res => {
      if(res.status === 401) alert("Unauthorized");
      else { adminLoggedIn = true; document.getElementById("adminSection").style.display = "block"; }
    });
  }
}

function fetchVideos() {
  fetch("/videos").then(res => res.json()).then(videos => {
    const container = document.getElementById("videoContainer");
    container.innerHTML = "";
    videos.forEach(v => {
      const videoEl = document.createElement("video");
      videoEl.src = v.url;
      videoEl.controls = true;
      container.appendChild(videoEl);

      if(adminLoggedIn) {
        const delBtn = document.createElement("button");
        delBtn.innerText = "Delete";
        delBtn.onclick = () => {
          fetch("/delete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ filename: v.filename, user: "admin", pass: "1234" })
          }).then(res => { fetchVideos(); });
        };
        container.appendChild(delBtn);
      }
    });
  });
}

fetchVideos();

const uploadForm = document.getElementById("uploadForm");
uploadForm.onsubmit = function(e){
  e.preventDefault();
  const formData = new FormData(uploadForm);
  formData.append("user", "admin");
  formData.append("pass", "1234");

  const xhr = new XMLHttpRequest();
  xhr.open("POST","/upload",true);

  xhr.upload.onprogress = function(e){
    const percent = (e.loaded / e.total) * 100;
    document.getElementById("progressBar").style.width = percent + "%";
  }

  xhr.onload = function(){
    if(xhr.status === 200){
      document.getElementById("uploadStatus").innerText = "Upload Success!";
      fetchVideos();
    } else {
      document.getElementById("uploadStatus").innerText = "Upload Failed!";
    }
    document.getElementById("progressBar").style.width = "0%";
  }

  xhr.send(formData);
}
</script>
</body>
</html>