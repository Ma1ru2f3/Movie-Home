<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MovieBox</title>
<style>
body{font-family:sans-serif; margin:0; padding:0;}
nav{background:#333;color:#fff;padding:10px;display:flex;gap:20px;}
nav button{background:#444;color:#fff;border:none;padding:5px 10px;cursor:pointer;}
section{padding:10px;}
.video-card{border:1px solid #ccc;padding:10px;margin:10px 0;}
.progress-container{width:100%;background:#eee;height:20px;margin:5px 0;display:none;}
.progress-bar{height:100%;background:#4caf50;width:0%;}
</style>
</head>
<body>

<nav>
  <button id="homeBtn">Home</button>
  <button id="searchBtn">Search</button>
  <button id="favBtn">Favorite</button>
  <button id="profileBtn">Profile</button>
</nav>

<section id="content">
  <div id="homeView">
    <h2>Home</h2>
    <div id="videosContainer"></div>
  </div>

  <div id="searchView" style="display:none;">
    <h2>Search</h2>
    <input type="text" id="searchInput" placeholder="Search title...">
    <div id="searchResults"></div>
  </div>

  <div id="favView" style="display:none;">
    <h2>Favorite</h2>
    <div id="favContainer"></div>
  </div>

  <div id="profileView" style="display:none;">
    <h2>Admin Login</h2>
    <input type="text" id="adminUser" placeholder="Username"><br>
    <input type="password" id="adminPass" placeholder="Password"><br>
    <button id="loginBtn">Login</button>

    <div id="uploadSection" style="display:none;">
      <h3>Upload Video</h3>
      <input type="text" id="titleInput" placeholder="Video Title"><br>
      <input type="file" id="fileInput"><br>
      <button id="uploadBtn">Upload</button>
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div id="uploadStatus"></div>
    </div>
  </div>
</section>

<script>
const homeBtn=document.getElementById("homeBtn");
const searchBtn=document.getElementById("searchBtn");
const favBtn=document.getElementById("favBtn");
const profileBtn=document.getElementById("profileBtn");

const homeView=document.getElementById("homeView");
const searchView=document.getElementById("searchView");
const favView=document.getElementById("favView");
const profileView=document.getElementById("profileView");

const videosContainer=document.getElementById("videosContainer");
const searchInput=document.getElementById("searchInput");
const searchResults=document.getElementById("searchResults");
const favContainer=document.getElementById("favContainer");

const adminUser=document.getElementById("adminUser");
const adminPass=document.getElementById("adminPass");
const loginBtn=document.getElementById("loginBtn");
const uploadSection=document.getElementById("uploadSection");
const fileInput=document.getElementById("fileInput");
const uploadBtn=document.getElementById("uploadBtn");
const progressContainer=document.getElementById("progressContainer");
const progressBar=document.getElementById("progressBar");
const uploadStatus=document.getElementById("uploadStatus");
const titleInput=document.getElementById("titleInput");

let isAdmin=false;
let videos=[];

// Navigation
homeBtn.onclick=()=>{showView(homeView); renderVideos();}
searchBtn.onclick=()=>{showView(searchView);}
favBtn.onclick=()=>{showView(favView);}
profileBtn.onclick=()=>{showView(profileView);}

function showView(view){
  [homeView,searchView,favView,profileView].forEach(v=>v.style.display="none");
  view.style.display="block";
}

// Render videos
function renderVideos(){
  videosContainer.innerHTML="";
  videos.forEach(v=>{
    const div=document.createElement("div");
    div.className="video-card";
    div.innerHTML=`<h4>${v.title}</h4><video width="320" controls src="${v.url}"></video>`;
    if(isAdmin){
      const delBtn=document.createElement("button");
      delBtn.innerText="Delete";
      delBtn.onclick=()=>deleteVideo(v.public_id);
      div.appendChild(delBtn);
    }
    videosContainer.appendChild(div);
  });
}

// Fetch videos from server
async function fetchVideos(){
  const res=await fetch("/videos");
  videos=await res.json();
  renderVideos();
}
fetchVideos();

// Admin login
loginBtn.onclick=()=>{
  if(adminUser.value==="admin" && adminPass.value==="1234"){
    isAdmin=true;
    uploadSection.style.display="block";
    alert("Admin logged in ✅");
  }else alert("Invalid credentials ❌");
}

// Upload video
uploadBtn.onclick=()=>{
  const file=fileInput.files[0];
  const title=titleInput.value || file.name;
  if(!file) return alert("Select a video");

  progressContainer.style.display="block";
  progressBar.style.width="0%";
  uploadStatus.innerText="Uploading...";

  const formData=new FormData();
  formData.append("video",file);
  formData.append("title",title);
  formData.append("user","admin");
  formData.append("pass","1234");

  const xhr=new XMLHttpRequest();
  xhr.open("POST","/upload",true);

  xhr.upload.addEventListener("progress",(e)=>{
    if(e.lengthComputable){
      const percent=Math.round((e.loaded/e.total)*100);
      progressBar.style.width=percent+"%";
    }
  });

  xhr.onreadystatechange=()=>{
    if(xhr.readyState===4){
      if(xhr.status===200){
        const data=JSON.parse(xhr.responseText);
        videos.push(data);
        renderVideos();
        uploadStatus.innerText="Uploaded Successfully ✅";
        setTimeout(()=>{
          progressContainer.style.display="none";
          progressBar.style.width="0%";
          uploadStatus.innerText="";
        },2000);
      }else uploadStatus.innerText="Upload Failed ❌";
    }
  }
  xhr.send(formData);
}

// Delete video
async function deleteVideo