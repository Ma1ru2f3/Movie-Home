<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moviebox</title>
<style>
body { font-family: Arial, sans-serif; padding: 0; margin:0; }
nav { display: flex; background:#333; color:white; padding:10px; }
nav div { margin-right:20px; cursor:pointer; }
section { padding:20px; }
input, button { padding:8px; margin:5px 0; }
.video-item { border:1px solid #ccc; padding:10px; margin-bottom:10px; }
video { width:300px; display:block; margin-bottom:5px; }
#searchBar { width:300px; padding:5px; margin-bottom:10px; }
</style>
</head>
<body>

<nav>
  <div onclick="showSection('home')">Home</div>
  <div onclick="showSection('fvrt')">Favourites</div>
  <div onclick="showSection('profile')">Profile</div>
</nav>

<section id="home">
  <h2>Home</h2>
  <input type="text" id="searchBar" placeholder="Search videos..." oninput="filterVideos()">
  <div id="videoGallery"></div>
</section>

<section id="fvrt" style="display:none;">
  <h2>Favourites</h2>
  <div id="favouritesList">No favourite videos yet.</div>
</section>

<section id="profile" style="display:none;">
  <h2>Profile</h2>
  
  <div id="loginDiv">
    <input type="text" id="adminUser" placeholder="Admin ID">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div id="adminPanel" style="display:none;">
    <h3>Upload Video</h3>
    <input type="file" id="videoFile">
    <button onclick="uploadVideo()">Upload</button>

    <h3>Uploaded Videos</h3>
    <div id="videoList"></div>
  </div>
</section>

<script>
const CLOUD_NAME = "dlxa4684c";
const UPLOAD_PRESET = "Moviebox";
let loggedIn = false;
let videos = []; // All uploaded video URLs
let favourites = [];

const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

function login(){
  const user = document.getElementById("adminUser").value;
  const pass = document.getElementById("adminPass").value;
  if(user===ADMIN_USER && pass===ADMIN_PASS){
    loggedIn = true;
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    alert("Login Successful!");
    loadVideos();
  } else {
    alert("Invalid credentials!");
  }
}

function uploadVideo(){
  if(!loggedIn){ alert("Login first"); return; }

  const fileInput = document.getElementById("videoFile");
  if(fileInput.files.length===0){ alert("Select a video!"); return; }

  const file = fileInput.files[0];
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", UPLOAD_PRESET);

  fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`, {
    method:"POST",
    body: formData
  })
  .then(res=>res.json())
  .then(data=>{
    alert("Upload Successful!");
    videos.push({url: data.secure_url, name: data.original_filename});
    displayVideos();
    loadVideos();
  })
  .catch(err=>console.error(err));
}

function loadVideos(){
  displayVideos();
}

function displayVideos(){
  const videoGallery = document.getElementById("videoGallery");
  const videoList = document.getElementById("videoList");
  
  videoGallery.innerHTML="";
  videoList.innerHTML="";

  videos.forEach((vid, index)=>{
    // Home Gallery
    const divHome = document.createElement("div");
    divHome.className = "video-item";
    divHome.innerHTML = `
      <video src="${vid.url}" controls></video>
      <button onclick="addFavourite(${index})">Add to Favourites</button>
    `;
    videoGallery.appendChild(divHome);

    // Admin List
    const divAdmin = document.createElement("div");
    divAdmin.className = "video-item";
    divAdmin.innerHTML = `
      <video src="${vid.url}" controls></video>
      <button onclick="deleteVideo(${index})">Delete</button>
    `;
    videoList.appendChild(divAdmin);
  });
}

function addFavourite(index){
  const vid = videos[index];
  if(!favourites.includes(vid)){
    favourites.push(vid);
    renderFavourites();
  }
}

function renderFavourites(){
  const favDiv = document.getElementById("favouritesList");
  favDiv.innerHTML="";
  favourites.forEach(vid=>{
    const div = document.createElement("div");
    div.className="video-item";
    div.innerHTML = `<video src="${vid.url}" controls></video>`;
    favDiv.appendChild(div);
  });
}

function deleteVideo(index){
  if(!loggedIn){ alert("Login first"); return; }
  videos.splice(index, 1);
  displayVideos();
  renderFavourites();
}

function filterVideos(){
  const term = document.getElementById("searchBar").value.toLowerCase();
  const videoGallery = document.getElementById("videoGallery");
  videoGallery.innerHTML="";

  videos.forEach((vid, index)=>{
    if(vid.name.toLowerCase().includes(term)){
      const divHome = document.createElement("div");
      divHome.className = "video-item";
      divHome.innerHTML = `<video src="${vid.url}" controls></video>
        <button onclick="addFavourite(${index})">Add to Favourites</button>`;
      videoGallery.appendChild(divHome);
    }
  });
}
</script>

</body>
</html>