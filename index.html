<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MovieBox</title>
<style>
body{font-family: Arial; margin:0; padding:0; background:#f0f0f0;}
header{background:#333; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center;}
nav a{color:white; margin:0 10px; text-decoration:none;}
.container{padding:20px;}
input[type=text]{padding:5px; width:200px;}
button{padding:5px 10px; margin:2px;}
.video-item{background:white; padding:10px; margin:10px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center;}
.dropdown{cursor:pointer;}
.hidden{display:none;}
</style>
</head>
<body>

<header>
    <div><strong>MovieBox</strong></div>
    <nav>
        <a href="#" onclick="showHome()">Home</a>
        <a href="#" onclick="showSearch()">Search</a>
        <a href="#" onclick="showHistory()">History</a>
        <a href="#" onclick="showProfile()">Profile</a>
    </nav>
</header>

<div class="container" id="mainContent">
<!-- Content will render here -->
</div>

<!-- Profile content -->
<div class="container hidden" id="profileContent"></div>

<script>
// Sample Data
let videos = [];
let users = [{name:"Admin",email:"admin@movie.com",isAdmin:true,password:"123450",blocked:false}];
let currentUser = null;
let historyData = {};

// Show Sections
function clearContent(){
    document.getElementById("mainContent").innerHTML="";
    document.getElementById("profileContent").classList.add("hidden");
}

function showHome(){
    clearContent();
    let html="<h2>Home</h2>";
    if(videos.length===0) html+="<p>No videos uploaded yet.</p>";
    else videos.forEach((v,i)=>{
        html+=`<div class="video-item">
        <div>${v.title}</div>
        <div>
            <button onclick="playVideo(${i})">Play</button>
            ${currentUser && currentUser.isAdmin?`<button onclick="deleteVideo(${i})">Delete</button>`:""}
        </div>
        </div>`;
    });
    document.getElementById("mainContent").innerHTML=html;
}

function showSearch(){
    clearContent();
    let html=`<h2>Search</h2>
    <input type="text" id="searchInput" placeholder="Search by title">
    <button onclick="searchVideo()">Search</button>
    <div id="searchResults"></div>`;
    document.getElementById("mainContent").innerHTML=html;
}

function showHistory(){
    clearContent();
    let html="<h2>History</h2>";
    if(!currentUser){ html+="<p>Please login to see history.</p>"; }
    else{
        let h = historyData[currentUser.email] || [];
        if(h.length===0) html+="<p>No history yet.</p>";
        else html+="<ul>"+h.map(v=>`<li>${v}</li>`).join("")+"</ul>";
    }
    document.getElementById("mainContent").innerHTML=html;
}

// Profile & Login
function showProfile(){
    clearContent();
    document.getElementById("profileContent").classList.remove("hidden");
    renderProfile();
}

function renderProfile(){
    if(!currentUser){
        document.getElementById("profileContent").innerHTML = `
        <h2>Login</h2>
        <input type="text" id="loginEmail" placeholder="Email"><br>
        <input type="password" id="loginPass" placeholder="Password"><br>
        <button onclick="login()">Login</button>`;
        return;
    }

    let html = `<p>Welcome, ${currentUser.name} (${currentUser.email})</p>`;

    if(currentUser.isAdmin){
        html += `<h3>Admin Panel</h3>
        <h4>Upload Video</h4>
        <input type="text" id="videoTitle" placeholder="Video Title"><br>
        <input type="text" id="videoLink" placeholder="Video Link"><br>
        <button onclick="uploadVideo()">Upload</button>
        <h4>Users List</h4>`;
        users.forEach((u,i)=>{
            html += `<div>${u.name} (${u.email}) - ${u.blocked ? 'Blocked':'Active'}
            <button onclick="toggleBlock(${i})">${u.blocked ? 'Unblock':'Block'}</button></div>`;
        });
    } else {
        html += `<p>User Panel</p>
        <h4>Your History</h4>`;
        let userHist = historyData[currentUser.email] || [];
        if(userHist.length === 0) html += "<p>No history yet.</p>";
        else html += "<ul>"+userHist.map(v=>`<li>${v}</li>`).join("")+"</ul>";
    }

    html += `<br><button onclick="logout()">Logout</button>`;
    document.getElementById("profileContent").innerHTML = html;
}

// Video Functions
function uploadVideo(){
    let title = document.getElementById("videoTitle").value;
    let link = document.getElementById("videoLink").value;
    if(!title || !link){ alert("Fill both fields"); return; }
    videos.push({title:title,link:link});
    alert("Video uploaded");
    showHome();
}

function deleteVideo(i){
    if(confirm("Delete this video?")){ videos.splice(i,1); showHome(); }
}

function playVideo(i){
    let v = videos[i];
    if(!currentUser){ alert("Please login to watch"); return; }
    // Add to history
    if(!historyData[currentUser.email]) historyData[currentUser.email]=[];
    historyData[currentUser.email].push(v.title);
    clearContent();
    document.getElementById("mainContent").innerHTML = `
    <h2>${v.title}</h2>
    <iframe width="560" height="315" src="${v.link}" frameborder="0" allowfullscreen></iframe>
    <br><button onclick="showHome()">Back</button>`;
}

// Search Function
function searchVideo(){
    let q=document.getElementById("searchInput").value.toLowerCase();
    let results = videos.filter(v=>v.title.toLowerCase().includes(q));
    let html="";
    if(results.length===0) html="<p>No videos found.</p>";
    else html = results.map((v,i)=>`<div class="video-item">
        <div>${v.title}</div>
        <div><button onclick="playVideo(${videos.indexOf(v)})">Play</button></div>
    </div>`).join("");
    document.getElementById("searchResults").innerHTML = html;
}

// User Functions
function login(){
    let email = document.getElementById("loginEmail").value;
    let pass = document.getElementById("loginPass").value;
    let user = users.find(u=>u.email===email && u.password===pass);
    if(!user){ alert("Invalid credentials"); return; }
    if(user.blocked){ alert("You are blocked"); return; }
    currentUser = user;
    renderProfile();
    alert("Login successful");
}

function logout(){ currentUser=null; renderProfile(); showHome(); }

function toggleBlock(i){ users[i].blocked = !users[i].blocked; renderProfile(); }

showHome(); // initial load
</script>

</body>
</html>