<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Box</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
header { background:#111; color:#fff; display:flex; justify-content:space-around; padding:10px; }
header button { padding:10px 20px; cursor:pointer; background:#222; color:#fff; border:none; border-radius:5px; }
section { padding:20px; display:none; }
section.active { display:block; }
.video-card { border:1px solid #ccc; padding:10px; margin:10px 0; background:#fff; border-radius:5px; }
.video-card iframe, .video-card video { width:100%; max-width:500px; height:280px; }
input { margin:5px 0; padding:5px; width:90%; }
.fav-btn { display:block; margin-top:5px; background:#ff4081; color:#fff; border:none; padding:5px 10px; border-radius:3px; cursor:pointer; }
</style>
</head>
<body>
<header>
  <button onclick="showSection('home')">Home</button>
  <button onclick="showSection('search')">Search</button>
  <button onclick="showSection('favourite')">Favourite</button>
  <button onclick="showSection('profile')">Profile</button>
</header>

<section id="home" class="active">
  <h2>Home</h2>
  <div id="videoList"></div>
</section>

<section id="search">
  <h2>Search</h2>
  <input type="text" id="searchInput" placeholder="Search video..." oninput="searchVideo()">
  <div id="searchResults"></div>
</section>

<section id="favourite">
  <h2>Favourite Videos</h2>
  <div id="favList"></div>
</section>

<section id="profile">
  <h2>Profile</h2>
  <button onclick="showProfileTab('admin')">Admin Access</button>
  <button onclick="showProfileTab('owner')">Owner Info</button>

  <div id="adminTab" style="display:none;">
    <h3>Admin Dashboard</h3>
    <input type="text" id="videoTitle" placeholder="Video Title"><br>
    <input type="text" id="videoLink" placeholder="Video Link (YouTube, Facebook, TikTok, MP4, etc)"><br>
    <input type="text" id="videoCategory" placeholder="Category"><br>
    <button onclick="uploadVideo()">Upload Video</button>
    <h4>Video List</h4>
    <div id="adminVideoList"></div>
  </div>

  <div id="ownerTab" style="display:none;">
    <pre>
┏━━━━━━━━━━━━━━━━━━━━━┓
┃      🌟 𝗢𝗪𝗡𝗘𝗥 𝗜𝗡𝗙𝗢 🌟      ┃
┣━━━━━━━━━━━━━━━━━━━━━┫
┃ 👤 Name      : Maruf Hossain
┃ 🚹 Gender    : Male
┃ ❤ Relation : Single
┃ 🎂 Age       : 17+
┃ 🕌 Religion : Islam
┃ 🏫 Education : SSC 25
┃ 🏡 Address  : Meherpur, Bangladesh
┣━━━━━━━━━━━━━━━━━━━━━┫
┃ 🎭 Tiktok   : Srotoshini
┃ 📢 Telegram : ×
┃ 🌐 Facebook : fb.com/profile.php?id=100066542686904
┗━━━━━━━━━━━━━━━━━━━┛
    </pre>
  </div>

  <div id="adminLoginDiv">
    <input type="text" id="adminId" placeholder="Admin ID"><br>
    <input type="password" id="adminPass" placeholder="Admin Password"><br>
    <button onclick="loginAdmin()">Login as Admin</button>
  </div>
</section>

<script>
const apiURL = 'https://sheetdb.io/api/v1/3p5l2ilgzemvr';
let allVideos = [];
let favVideos = JSON.parse(localStorage.getItem('favVideos')) || [];
let isAdmin = false;

function showSection(id){
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id==='home') fetchVideos();
  if(id==='favourite') showFavVideos();
}

function showProfileTab(tab){
  document.getElementById('adminTab').style.display='none';
  document.getElementById('ownerTab').style.display='none';
  if(tab==='admin' && isAdmin) document.getElementById('adminTab').style.display='block';
  if(tab==='owner') document.getElementById('ownerTab').style.display='block';
}

async function fetchVideos(){
  try{
    const res = await fetch(apiURL);
    const data = await res.json();
    allVideos = data;
    const list = document.getElementById('videoList');
    list.innerHTML = '';
    data.forEach(v=>{
      const div = document.createElement('div');
      div.className='video-card';
      div.innerHTML = `
        <strong>${v.Title}</strong><br>
        ${embedVideo(v.Link)}
        <button class="fav-btn" onclick="addFav('${v.Title}','${v.Link}','${v.Category}')">Favourite</button>
      `;
      list.appendChild(div);
    });
  } catch(err){ console.error('Fetch error', err); }
}

// Universal embed function
function embedVideo(link){
  if(link.includes('youtube.com') || link.includes('youtu.be')){
    const id = extractYouTubeID(link);
    return `<iframe src="https://www.youtube.com/embed/${id}?modestbranding=1" frameborder="0" allowfullscreen></iframe>`;
  } else if(link.includes('facebook.com')){
    return `<iframe src="${link}" frameborder="0" allowfullscreen></iframe>`;
  } else if(link.includes('tiktok.com')){
    return `<iframe src="${link}" frameborder="0" allowfullscreen></iframe>`;
  } else if(link.endsWith('.mp4')){
    return `<video controls src="${link}"></video>`;
  } else {
    return `<a href="${link}" target="_blank">Open Video</a>`;
  }
}

function extractYouTubeID(url){
  const reg = /(?:https?:\/\/)?(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([\w-]{11})/;
  const match = url.match(reg);
  return match ? match[1] : '';
}

function addFav(title,link,category){
  if(!favVideos.find(v=>v.Link===link)){
    favVideos.push({Title:title, Link:link, Category:category});
    localStorage.setItem('favVideos', JSON.stringify(favVideos));
    alert('Added to Favourite');
  } else alert('Already in Favourite');
}

function showFavVideos(){
  const list = document.getElementById('favList');
  list.innerHTML='';
  favVideos.forEach(v=>{
    const div = document.createElement('div');
    div.className='video-card';
    div.innerHTML = `
      <strong>${v.Title}</strong><br>
      ${embedVideo(v.Link)}
      <button class="fav-btn" onclick="removeFav('${v.Link}')">Remove</button>
    `;
    list.appendChild(div);
  });
}

function removeFav(link){
  favVideos = favVideos.filter(v=>v.Link!==link);
  localStorage.setItem('favVideos', JSON.stringify(favVideos));
  showFavVideos();
}

async function loginAdmin(){
  const id = document.getElementById('adminId').value;
  const pass = document.getElementById('adminPass').value;
  if(id==='112233445500' && pass==='123450'){
    isAdmin = true;
    alert('Admin logged in');
    document.getElementById('adminLoginDiv').style.display='none';
    showProfileTab('admin');
    fetchAdminVideos();
  } else alert('Invalid Admin');
}

async function uploadVideo(){
  if(!isAdmin){ alert('Only admin can upload'); return; }
  const title = document.getElementById('videoTitle').value;
  const link = document.getElementById('videoLink').value;
  const cat = document.getElementById('videoCategory').value;
  if(!title || !link){ alert('Enter title and link'); return; }
  await fetch(apiURL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({data:{Title:title, Link:link, Category:cat}})
  });
  alert('Video Uploaded');
  fetchAdminVideos();
}

async function fetchAdminVideos(){
  const res = await fetch(apiURL);
  const data = await res.json();
  const list = document.getElementById('adminVideoList');
  list.innerHTML='';
  data.forEach(v=>{
    const div = document.createElement('div');
    div.className='video-card';
    div.innerHTML = `<strong>${v.Title}</strong> <button onclick="deleteVideo('${v.id}')">Delete</button>`;
    list.appendChild(div);
  });
}

async function deleteVideo(id){
  if(confirm('Delete this video?')){
    await fetch(`${apiURL}/id/${id}`,{method:'DELETE'});
    fetchAdminVideos();
  }
}

function searchVideo(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  const results = allVideos.filter(v=>v.Title.toLowerCase().includes(q));
  const container = document.getElementById('searchResults');
  container.innerHTML='';
  results.forEach(v=>{
    const div = document.createElement('div');
    div.className='video-card';
    div.innerHTML = `
      <strong>${v.Title}</strong><br>
      ${embedVideo(v.Link)}
      <button class="fav-btn" onclick="addFav('${v.Title}','${v.Link}','${v.Category}')">Favourite</button>
    `;
    container.appendChild(div);
  });
}

// Initial load
fetchVideos();
</script>
</body>
</html>