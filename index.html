<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moviebox</title>
<style>
  body { font-family: Arial; margin:0; padding:0; }
  nav { display:flex; justify-content:space-around; background:#333; color:white; padding:10px; }
  nav button { background:none; border:none; color:white; font-size:16px; cursor:pointer; }
  #home-videos div { margin:10px 0; }
  #progress { width:0; height:20px; background:green; color:white; text-align:center; }
</style>
</head>
<body>

<nav>
  <button onclick="showPage('home')">Home</button>
  <button onclick="showPage('search')">Search</button>
  <button onclick="showPage('fvrt')">Fvrt</button>
  <button onclick="showPage('profile')">Profile</button>
</nav>

<div id="pages">
  <div id="home">
    <h2>Home</h2>
    <div id="home-videos"></div>
  </div>

  <div id="search" style="display:none">
    <h2>Search</h2>
    <input type="text" id="search-input" placeholder="Search title">
    <div id="search-results"></div>
  </div>

  <div id="fvrt" style="display:none">
    <h2>Fvrt</h2>
    <div>Favorite videos list here...</div>
  </div>

  <div id="profile" style="display:none">
    <h2>Profile</h2>
    <div id="admin-login">
      <input type="text" id="user" placeholder="Username">
      <input type="password" id="pass" placeholder="Password">
      <button onclick="adminLogin()">Login</button>
    </div>
    <div id="admin-panel" style="display:none">
      <h3>Upload Video</h3>
      <input type="text" id="title" placeholder="Video Title">
      <input type="file" id="video">
      <button onclick="uploadVideo()">Upload</button>
      <div id="progress"></div>
    </div>
  </div>
</div>

<script>
let isAdmin = false;

function showPage(page) {
  document.querySelectorAll('#pages > div').forEach(d=>d.style.display='none');
  document.getElementById(page).style.display='block';
  if(page==='home') loadVideos();
}

// Admin login
function adminLogin() {
  const user = document.getElementById('user').value;
  const pass = document.getElementById('pass').value;
  if(user==='admin' && pass==='1234') {
    isAdmin=true;
    document.getElementById('admin-login').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    alert('Admin logged in');
  } else alert('Wrong credentials');
}

// Load videos for home
async function loadVideos() {
  const res = await fetch('/videos');
  const videos = await res.json();
  const home = document.getElementById('home-videos');
  home.innerHTML='';
  videos.forEach(v=>addVideoToHome(v));
}

function addVideoToHome(video){
  const home = document.getElementById('home-videos');
  const div = document.createElement('div');
  div.innerHTML = `
    <video src="${video.url}" controls width="300"></video>
    <p>${video.title}</p>
    ${isAdmin?`<button onclick="deleteVideo('${video.public_id}', this)">Delete</button>`:''}
  `;
  home.prepend(div);
}

// Upload video
async function uploadVideo(){
  const file = document.getElementById('video').files[0];
  const title = document.getElementById('title').value;
  const formData = new FormData();
  formData.append('video', file);
  formData.append('title', title);
  formData.append('user', 'admin');
  formData.append('pass', '1234');

  const xhr = new XMLHttpRequest();
  xhr.open('POST','/upload');

  xhr.upload.addEventListener('progress', e=>{
    const percent = Math.floor(e.loaded / e.total * 100);
    const bar = document.getElementById('progress');
    bar.style.width=percent+'%';
    bar.innerText=percent+'%';
  });

  xhr.onload = async ()=>{
    if(xhr.status===200){
      document.getElementById('progress').innerText='Success';
      const data = JSON.parse(xhr.response);
      addVideoToHome(data);
    } else alert('Upload failed');
  };

  xhr.send(formData);
}

// Delete video
async function deleteVideo(public_id, btn){
  const res = await fetch('/delete',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user:'admin', pass:'1234', public_id})
  });
  const result = await res.json();
  if(result.result==='ok') btn.parentElement.remove();
}
</script>

</body>
</html>